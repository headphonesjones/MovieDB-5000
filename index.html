<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Movie DB 5000</title>
    <link rel="stylesheet" href="css/app.css" />
    <script src="bower_components/modernizr/modernizr.js"></script>
  </head>
  <body>
    <div class="color_overlay"></div>
    <div class="row home_title-container" id="home-text">
      <div class="large-12 columns text-center">
        <h1>Movie Database <span class="bold-sans large-text db_model_number">5000</span></h1>
        <h5 class="home_sub_title">Search for any movie title and get results instantly</h5>
        <div class="medium-8 small-12 small-centered columns">
          <input type="text" id="home_movie_input" placeholder="Search movie titles" />

          <input type="button" id="submit_search-button" value="Search" />
        </div>
      </div>
    </div>

    <div class="row" id="movie_details-row">

    </div>
    <div class="row" id="movie_results-row">

    </div>

    <div class="small-1 columns small-centered "id="loader">
      <img src="img/ajax-loader.gif" alt="Results Loading">
    </div>


    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/foundation/js/foundation.min.js"></script>
    <script src="bower_components/greensock/src/minified/TweenMax.min.js"></script>
    <script src="bower_components/grapnel/dist/grapnel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0/handlebars.min.js"></script>
    <script src="js/app.js"></script>
    <script id="results_script" type="text/x-handlebars-template">
      <section class="movie_search_results-container large-8 large-centered columns" id="search-results">
        {{#each Search}}
        <a href="#/movie/{{imdbID}}"><h3><span class="bold-sans">{{Title}}</span> : {{Year}}</h3></a>
        <hr />
        {{/each}}
      </section>
    </script>
    <script id="movie_script" type="text/x-handlebars-template">
      <section class="movie_results-container large-12 columns" id="movie_box">
        <article class="movie_object-container large-12 columns">
          <img class="medium-4 small-12 columns movie_image" src="{{Poster}}"  width="300" height="auto" alt=" Cover"/>
          <div class="movie_info-container medium-8 small-12 columns">
            <h3>{{Title}}</h3>
            <h5>{{Released}}</h5>
            <p>{{Plot}}</p>
            <p>Actors: {{Actors}}</p>
          </div>
        </article>
      </section>
    </script>

    <script type="text/javascript">
    $("#loader").hide();

    var source   = $("#movie_script").html();
    var template = Handlebars.compile(source);

    var searchSource   = $("#results_script").html();
    var searchTemplate = Handlebars.compile(searchSource);

    var router = new Grapnel({ pushState: false });

    router.get('/search/:title?', function(req){
        
        var title = req.params.title;
        $("#home_movie_input").val(title);

        var searchAni = new TimelineLite({onComplete:movieSearch});
        searchAni.to( $(".color_overlay"), 1, {backgroundColor: 'rgb(255, 193, 7)'});
        searchAni.to( $("#home-text"), 1, {top: -270});
        searchAni.to( $("#movie_box"), 1, {top: -270});
        
        $( "#movie_details-row" ).html("");
        function movieSearch(){
          $("#loader").show();

          $.getJSON( "http://www.omdbapi.com/?s='" + title + "'&r=json&type=movie", function( data ) {
            var html = searchTemplate(data);
            //console.log(data);
            //console.log(html);
            $("#movie_results-row").html(html);
            var movieListPlaced = new TimelineLite();
              movieListPlaced.fromTo("#search-results", 1, { autoAlpha:0, ease:Linear.easeNone}, {autoAlpha:1, ease:Linear.easeNone});
            $("#loader").hide();
          });
        }
    });

    router.get('/movie/:id?', function(req){
        var id = req.params.id;
        $(".color_overlay").css("background-color", "rgb(255, 193, 7)");
        $("#home-text").css("top", "-270px");
        $("#movie_box").css("top", "-270px");
        $("#movie_box").css("opacity", "1");

        function resultsSlide(){
          $("#loader").show();
          
          var listAni = new TimelineLite({onComplete:moviePlace});
          listAni.to( $("#search-results"), 1.5, {top: 350});
          $("html, body").animate({ scrollTop: 0 }, "slow");
          return false;
        }
        resultsSlide();
        function moviePlace(){
          $.getJSON( "http://www.omdbapi.com/?i="+ id + "&r=json&type=movie&plot=short", function( data ) {
            var html = template(data);
            //console.log(data);
            $( "#movie_details-row" ).html(html);
              var moviePlaced = new TimelineLite();
              moviePlaced.fromTo("#movie_box", 1, { autoAlpha:0, ease:Linear.easeNone}, {autoAlpha:1, ease:Linear.easeNone});
              moviePlaced.to( $("#search-results"), 1, {top: -200});

              $("#loader").hide();



          });
        }
    });


    $( "#submit_search-button" ).click(function(e) {
        var searchTitle = $("#home_movie_input").val();
        router.navigate('/search/' + searchTitle);
        $("#loader").show();

    });
    </script>
    

  </body>
</html>
